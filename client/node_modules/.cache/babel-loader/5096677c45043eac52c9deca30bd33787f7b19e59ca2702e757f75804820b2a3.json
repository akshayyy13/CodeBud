{"ast":null,"code":"import _objectSpread from\"/Users/akshayshrivastava/Desktop/CodeBud/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import toast from\"react-hot-toast\";import{apiConnector}from\"../apiconnector\";import rzpLogo from\"../../assets/Logo/codebudhd.png\";import{setPaymentLoading}from\"../../slices/courseSlice\";import{resetCart}from\"../../slices/cartSlice\";import{studentEndpoints}from\"../apis\";const{COURSE_PAYMENT_API,COURSE_VERIFY_API,SEND_PAYMENT_SUCCESS_EMAIL_API}=studentEndpoints;function loadScript(src){return new Promise(resolve=>{const script=document.createElement(\"script\");script.src=src;script.onload=()=>{resolve(true);};script.onerror=()=>{resolve(false);};document.body.appendChild(script);});}export async function buyCourse(token,courses,userDetails,navigate,dispatch){const toastId=toast.loading(\"Loading...\");try{//load the script\nconst res=await loadScript(\"https://checkout.razorpay.com/v1/checkout.js\");if(!res){toast.error(\"RazorPay SDK failed to load\");return;}//initiate the order\nconst orderResponse=await apiConnector(\"POST\",COURSE_PAYMENT_API,{courses},{Authorization:\"Bearer \".concat(token)});// console.log(\"Order Response ->\",orderResponse)\nif(!orderResponse.data.success){throw new Error(orderResponse.data.message);}console.log(\"PRINTING orderResponse\\n\",orderResponse);//options\nconst options={key:orderResponse.data.key,currency:orderResponse.data.message.currency,amount:\"\".concat(orderResponse.data.message.amount),order_id:orderResponse.data.message.id,name:\"CodeBud\",description:\"Thank You for Purchasing the Course\",image:rzpLogo,prefill:{name:\"\".concat(userDetails.firstName),email:userDetails.email},handler:function(response){//send successful wala mail\n// console.log(\"Response inside\",response)\nsendPaymentSuccessEmail(response,orderResponse.data.message.amount,token);//verifyPayment\nverifyPayment(_objectSpread(_objectSpread({},response),{},{courses}),token,navigate,dispatch);}};//miss hogya tha\nconst paymentObject=new window.Razorpay(options);paymentObject.open();paymentObject.on(\"payment.failed\",function(response){toast.error(\"oops, payment failed\");console.log(response.error);});// navigate(\"/dashboard/enrolled-courses\");\n}catch(error){console.log(\"PAYMENT API ERROR.....\",error);toast.error(\"Could not make Payment\");}toast.dismiss(toastId);}async function sendPaymentSuccessEmail(response,amount,token){try{// console.log(\"Sending email ->\",response,amount)\nawait apiConnector(\"POST\",SEND_PAYMENT_SUCCESS_EMAIL_API,{orderId:response.razorpay_order_id,paymentId:response.razorpay_payment_id,amount},{Authorization:\"Bearer \".concat(token)});// console.log(\"Mail sended\")\n}catch(error){console.log(\"Payment Success email error \",error);}}async function verifyPayment(bodyData,token,navigate,dispatch){dispatch(setPaymentLoading(true));try{// console.log(\"Verify Api check and bodyData -> \",bodyData)\nconst response=await apiConnector(\"POST\",COURSE_VERIFY_API,bodyData,{Authorization:\"Bearer \".concat(token)});// console.log(\"Verify Api checked\")\nif(!response.data.success)throw new Error(response.data.message);toast.success(\"Payment Successfull\");navigate(\"/dashboard/enrolled-courses\");dispatch(resetCart());}catch(error){console.log(\"Payment Verify Error -> \",error);toast.error(\"Could not verify payment\");}toast.dismiss();dispatch(setPaymentLoading(false));}","map":{"version":3,"names":["toast","apiConnector","rzpLogo","setPaymentLoading","resetCart","studentEndpoints","COURSE_PAYMENT_API","COURSE_VERIFY_API","SEND_PAYMENT_SUCCESS_EMAIL_API","loadScript","src","Promise","resolve","script","document","createElement","onload","onerror","body","appendChild","buyCourse","token","courses","userDetails","navigate","dispatch","toastId","loading","res","error","orderResponse","Authorization","concat","data","success","Error","message","console","log","options","key","currency","amount","order_id","id","name","description","image","prefill","firstName","email","handler","response","sendPaymentSuccessEmail","verifyPayment","_objectSpread","paymentObject","window","Razorpay","open","on","dismiss","orderId","razorpay_order_id","paymentId","razorpay_payment_id","bodyData"],"sources":["/Users/akshayshrivastava/Desktop/CodeBud/client/src/services/operations/studentFeaturesAPI.js"],"sourcesContent":["import toast from \"react-hot-toast\";\nimport { apiConnector } from \"../apiconnector\";\nimport rzpLogo from \"../../assets/Logo/codebudhd.png\";\nimport { setPaymentLoading } from \"../../slices/courseSlice\";\nimport { resetCart } from \"../../slices/cartSlice\";\nimport { studentEndpoints } from \"../apis\";\n\n\n\nconst {\n  COURSE_PAYMENT_API,\n  COURSE_VERIFY_API,\n  SEND_PAYMENT_SUCCESS_EMAIL_API,\n} = studentEndpoints;\n\nfunction loadScript(src) {\n  return new Promise((resolve) => {\n    const script = document.createElement(\"script\");\n    script.src = src;\n\n    script.onload = () => {\n      resolve(true);\n    };\n    script.onerror = () => {\n      resolve(false);\n    };\n    document.body.appendChild(script);\n  });\n}\n\nexport async function buyCourse(\n  token,\n  courses,\n  userDetails,\n  navigate,\n  dispatch\n) {\n  const toastId = toast.loading(\"Loading...\");\n  try {\n    //load the script\n    const res = await loadScript(\n      \"https://checkout.razorpay.com/v1/checkout.js\"\n    );\n\n    if (!res) {\n      toast.error(\"RazorPay SDK failed to load\");\n      return;\n    }\n    //initiate the order\n    const orderResponse = await apiConnector(\n      \"POST\",\n      COURSE_PAYMENT_API,\n      { courses },\n      {\n        Authorization: `Bearer ${token}`,\n      }\n    );\n      // console.log(\"Order Response ->\",orderResponse)\n    if (!orderResponse.data.success) {\n      throw new Error(orderResponse.data.message);\n    }\n    console.log(\"PRINTING orderResponse\\n\", orderResponse);\n\n    //options\n    const options = {\n      key: orderResponse.data.key,\n      currency: orderResponse.data.message.currency,\n      amount: `${orderResponse.data.message.amount}`,\n      order_id: orderResponse.data.message.id,\n      name: \"CodeBud\",\n      description: \"Thank You for Purchasing the Course\",\n      image: rzpLogo,\n      prefill: {\n        name: `${userDetails.firstName}`,\n        email: userDetails.email,\n      },\n      handler: function (response) {\n        //send successful wala mail\n        // console.log(\"Response inside\",response)\n        sendPaymentSuccessEmail(response, orderResponse.data.message.amount, token);\n        //verifyPayment\n        verifyPayment({ ...response, courses }, token, navigate, dispatch);\n      },\n    };\n    //miss hogya tha\n    const paymentObject = new window.Razorpay(options);\n    paymentObject.open();\n    paymentObject.on(\"payment.failed\", function (response) {\n      toast.error(\"oops, payment failed\");\n      console.log(response.error);\n    });\n    // navigate(\"/dashboard/enrolled-courses\");\n  } catch (error) {\n    console.log(\"PAYMENT API ERROR.....\", error);\n    toast.error(\"Could not make Payment\");\n  }\n  toast.dismiss(toastId);\n}\n\nasync function sendPaymentSuccessEmail(response, amount, token) {\n  try {\n    // console.log(\"Sending email ->\",response,amount)\n    await apiConnector(\n      \"POST\",\n      SEND_PAYMENT_SUCCESS_EMAIL_API,\n      {\n        orderId: response.razorpay_order_id,\n        paymentId: response.razorpay_payment_id,\n        amount,\n      },\n      {\n        Authorization: `Bearer ${token}`,\n      }\n    );\n    // console.log(\"Mail sended\")\n  } catch (error) {\n    console.log(\"Payment Success email error \", error);\n  }\n}\n\nasync function verifyPayment(bodyData, token, navigate, dispatch) {\n\n  dispatch(setPaymentLoading(true));\n  try {\n    // console.log(\"Verify Api check and bodyData -> \",bodyData)\n    const response = await apiConnector(\"POST\", COURSE_VERIFY_API, bodyData, {\n      Authorization: `Bearer ${token}`,\n    });\n    \n    // console.log(\"Verify Api checked\")\n    if (!response.data.success) throw new Error(response.data.message);\n    toast.success(\"Payment Successfull\")\n    navigate(\"/dashboard/enrolled-courses\")\n    dispatch(resetCart());\n\n  } catch (error) {\n    console.log(\"Payment Verify Error -> \",error)\n    toast.error(\"Could not verify payment\")\n  }\n  toast.dismiss();\n  dispatch(setPaymentLoading(false))\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}